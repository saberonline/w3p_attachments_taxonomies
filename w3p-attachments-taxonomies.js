var tagBox;function array_unique_noempty(b){var c=[];jQuery.each(b,function(a,d){d=jQuery.trim(d);if(d&&jQuery.inArray(d,c)==-1){c.push(d)}});return c}(function(a){tagBox={clean:function(c){var b=postL10n.comma;if(","!==b){c=c.replace(new RegExp(b,"g"),",")}c=c.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"");if(","!==b){c=c.replace(/,/g,b)}return c},parseTags:function(f){var i=f.id,c=i.split("-check-num-")[1],e=a(f).parents(".tagsdiv"),h=e.find(".the-tags"),b=postL10n.comma,d=h.val().split(b),g=[];delete d[c];a.each(d,function(j,k){k=a.trim(k);if(k){g.push(k)}});h.val(this.clean(g.join(b)));this.quickClicks(e);return false},quickClicks:function(d){var g=a(".the-tags",d),e=a(".tagchecklist",d),f=a(d).attr("id"),b,c;if(!g.length){return}c=g.prop("disabled");b=g.val().split(postL10n.comma);e.empty();a.each(b,function(i,k){var j,h;k=a.trim(k);if(!k){return}j=a("<span />").text(k);if(!c){h=a('<a id="'+f+"-check-num-"+i+'" class="ntdelbutton">X</a>');h.click(function(){tagBox.parseTags(this)});j.prepend("&nbsp;").prepend(h)}e.append(j)})},flushTags:function(g,c,h){c=c||false;var d=a(".the-tags",g),j=a("input.newtag",g),b=postL10n.comma,e,i;i=c?a(c).text():j.val();tagsval=d.val();e=tagsval?tagsval+b+i:i;e=this.clean(e);e=array_unique_noempty(e.split(b)).join(b);d.val(e);this.quickClicks(g);if(!c){j.val("")}if("undefined"==typeof(h)){j.focus()}return false},get:function(d,b){var c=d.substr(d.indexOf("-")+1);a.post(ajaxurl,{action:"get-tagcloud",tax:c},function(f,e){if(0==f||"success"!=e){f=wpAjax.broken}f=a('<p id="tagcloud-'+c+'" class="the-tagcloud">'+f+"</p>");a("a",f).click(function(){tagBox.flushTags(a(this).parents(".field").children(".tagsdiv"),this);return false});a("a.tagcloud-link").eq(b).after(f)})},init:function(){var b=this,c=a("div.ajaxtag");a(".tagsdiv").each(function(){tagBox.quickClicks(this)});a("input.tagadd",c).click(function(){b.flushTags(a(this).parents(".tagsdiv"))});a("div.taghint",c).click(function(){a(this).css("visibility","hidden").parent().siblings(".newtag").focus()});a("input.newtag",c).blur(function(){if(this.value==""){a(this).parent().siblings(".taghint").css("visibility","")}}).focus(function(){a(this).parent().siblings(".taghint").css("visibility","hidden")}).keyup(function(d){if(13==d.which){tagBox.flushTags(a(this).parents(".tagsdiv"));return false}}).keypress(function(d){if(13==d.which){d.preventDefault();return false}}).each(function(){var d=a(this).parents("div.tagsdiv").attr("id");a(this).suggest(ajaxurl+"?action=ajax-tag-search&tax="+d,{delay:500,minchars:2,multiple:true,multipleSep:postL10n.comma+" "})});a("#media-single-form, #gallery-form").submit(function(){a(this).find("div.tagsdiv").each(function(){tagBox.flushTags(this,false,1)})});a("a.tagcloud-link").each(function(d,e){a(this).click(function(){tagBox.get(a(this).attr("id"),d);a(this).unbind().click(function(){a(this).siblings(".the-tagcloud").toggle();return false});return false})})}}})(jQuery);jQuery(document).ready(function(a){if(a(".tagsdiv").length){tagBox.init()}a(".categorydiv").each(function(f,c){var j=a(this),h=j.attr("id"),d=false,l,e,g,b,k;g=h.split("-");g.shift();b=g.join("-");k=b+"_tab";if(b=="category"){k="cats"}j.addClass(b+"-box-"+f);j.find("#"+b+"-tabs a").click(function(){var i=a(this).attr("href");a(this).parent().addClass("tabs").siblings("li").removeClass("tabs").parent().siblings(".tabs-panel").hide().filter(i).show();if("#"+b+"-all"==i){deleteUserSetting(k)}else{setUserSetting(k,"pop")}return false});if(getUserSetting(k)){j.find("#"+b+'-tabs a[href="#'+b+'-pop"]').click()}j.find("#new"+b).one("focus",function(){a(this).val("").removeClass("form-input-tip")});j.find("#"+b+"-add-submit").click(function(){a(this).siblings("#new"+b).focus()});l=function(){if(d){return}d=true;var i=a(this),n=i.is(":checked"),m=i.val().toString();i.parents(".tabs-panel").siblings(".tabs-panel").find("#in-"+b+"-"+m+", #in-"+b+"-category-"+m).prop("checked",n);d=false};catAddBefore=function(i){var m=a(i.target).parents("#"+b+"-adder");var n=m.parents(".categorydiv");if(!m.find("#new"+b).val()||!n.hasClass(b+"-box-"+f)){return false}i.data="_ajax_nonce=0&action=add-"+b+"&"+m.find("input, select").serialize();i.data+="&"+n.find(":checked").serialize()+"&w3p_taxos_att_id="+n.next('[name="w3p_taxos_att_id"]').val();m.find("#"+b+"-add-submit").prop("disabled",true);return i};e=function(o,n){var m,p=a(n.target).parents("#"+b+"-adder"),i=p.find("#new"+b+"_parent");p.find("#"+b+"-add-submit").prop("disabled",false);if("undefined"!=n.parsed.responses[0]&&(m=n.parsed.responses[0].supplemental.newcat_parent)&&p.parents(".categorydiv").hasClass(b+"-box-"+f)){i.before(m);i.remove()}};j.find("#"+b+"checklist").wpList({alt:"",response:b+"-ajax-response",addBefore:catAddBefore,addAfter:e});j.find("#"+b+"-add-toggle").click(function(){a(this).parents("#"+b+"-adder").toggleClass("wp-hidden-children").siblings("#"+b+"-tabs").find('a[href="#'+b+'-all"]').click();a(this).parents("#"+b+"-adder").find("#new"+b).focus();return false});j.find("#"+b+"checklist li.popular-category :checkbox, #"+b+"checklist-pop :checkbox").live("click",function(){var i=a(this),n=i.is(":checked"),m=i.val();if(m&&i.parents("#taxonomy-"+b).length){i.parents("#taxonomy-"+b).find("#in-"+b+"-"+m+", #in-popular-"+b+"-"+m).prop("checked",n)}})})});