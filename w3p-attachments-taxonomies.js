var tagBox;function array_unique_noempty(b){var c=[];jQuery.each(b,function(a,d){d=jQuery.trim(d);if(d&&jQuery.inArray(d,c)==-1){c.push(d)}});return c}(function(a){tagBox={clean:function(c){var b=postL10n.comma;if(","!==b){c=c.replace(new RegExp(b,"g"),",")}c=c.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"");if(","!==b){c=c.replace(/,/g,b)}return c},parseTags:function(f){var i=f.id,c=i.split("-check-num-")[1],e=a(f).parents(".tagsdiv"),h=e.find(".the-tags"),b=postL10n.comma,d=h.val().split(b),g=[];delete d[c];a.each(d,function(j,k){k=a.trim(k);if(k){g.push(k)}});h.val(this.clean(g.join(b)));this.quickClicks(e);return false},quickClicks:function(d){var g=a(".the-tags",d),e=a(".tagchecklist",d),f=a(d).attr("id"),b,c;if(!g.length){return}c=g.prop("disabled");b=g.val().split(postL10n.comma);e.empty();a.each(b,function(i,k){var j,h;k=a.trim(k);if(!k){return}j=a("<span />").text(k);if(!c){h=a('<a id="'+f+"-check-num-"+i+'" class="ntdelbutton">X</a>');h.click(function(){tagBox.parseTags(this)});j.prepend("&nbsp;").prepend(h)}e.append(j)})},flushTags:function(g,c,h){c=c||false;var d=a(".the-tags",g),j=a("input.newtag",g),b=postL10n.comma,e,i;i=c?a(c).text():j.val();tagsval=d.val();e=tagsval?tagsval+b+i:i;e=this.clean(e);e=array_unique_noempty(e.split(b)).join(b);d.val(e);this.quickClicks(g);if(!c){j.val("")}if("undefined"==typeof(h)){j.focus()}return false},get:function(d,b){var c=d.substr(d.indexOf("-")+1);a.post(ajaxurl,{action:"get-tagcloud",tax:c},function(f,e){if(0==f||"success"!=e){f=wpAjax.broken}f=a('<p id="tagcloud-'+c+'" class="the-tagcloud">'+f+"</p>");a("a",f).click(function(){tagBox.flushTags(a(this).parents(".field").children(".tagsdiv"),this);return false});a("a.tagcloud-link").eq(b).after(f)})},init:function(){var b=this,c=a("div.ajaxtag");a(".tagsdiv").each(function(){tagBox.quickClicks(this)});a("input.tagadd",c).click(function(){b.flushTags(a(this).parents(".tagsdiv"))});a("div.taghint",c).click(function(){a(this).css("visibility","hidden").parent().siblings(".newtag").focus()});a("input.newtag",c).blur(function(){if(this.value==""){a(this).parent().siblings(".taghint").css("visibility","")}}).focus(function(){a(this).parent().siblings(".taghint").css("visibility","hidden")}).keyup(function(d){if(13==d.which){tagBox.flushTags(a(this).parents(".tagsdiv"));return false}}).keypress(function(d){if(13==d.which){d.preventDefault();return false}}).each(function(){var d=a(this).parents("div.tagsdiv").attr("id");a(this).suggest(ajaxurl+"?action=ajax-tag-search&tax="+d,{delay:500,minchars:2,multiple:true,multipleSep:postL10n.comma+" "})});a("#media-single-form, #gallery-form").submit(function(){a(this).find("div.tagsdiv").each(function(){tagBox.flushTags(this,false,1)})});a("a.tagcloud-link").each(function(d,e){a(this).click(function(){tagBox.get(a(this).attr("id"),d);a(this).unbind().click(function(){a(this).siblings(".the-tagcloud").toggle();return false});return false})})}}})(jQuery);jQuery(document).ready(function(a){if(a(".tagsdiv").length){tagBox.init()}a(".categorydiv").each(function(){var g=a(this),h=g.attr("id"),c=false,f,i,e,b,d;e=h.split("-");e.shift();b=e.join("-");d=b+"_tab";if(b=="category"){d="cats"}g.find("#"+b+"-tabs a").click(function(){var j=a(this).attr("href");a(this).parent().addClass("tabs").siblings("li").removeClass("tabs").parent().siblings(".tabs-panel").hide().filter(j).show();if("#"+b+"-all"==j){deleteUserSetting(d)}else{setUserSetting(d,"pop")}return false});if(getUserSetting(d)){g.find("#"+b+'-tabs a[href="#'+b+'-pop"]').click()}g.find("#new"+b).one("focus",function(){a(this).val("").removeClass("form-input-tip")});g.find("#"+b+"-add-submit").click(function(){a(this).siblings("#new"+b).focus()});f=function(){if(c){return}c=true;var j=jQuery(this),l=j.is(":checked"),k=j.val().toString();j.parents(".tabs-panel").siblings(".tabs-panel").find("#in-"+b+"-"+k+", #in-"+b+"-category-"+k).prop("checked",l);c=false};catAddBefore=function(j){var k=a(this).parent(".tabs-panel").siblings("#"+b+"-adder");if(!k.find("#new"+b).val()){return false}j.data+="&"+a(":checked",this).serialize();k.find("#"+b+"-add-submit").prop("disabled",true);return j};i=function(m,l){var k,n=a(this).parent(".tabs-panel").siblings("#"+b+"-adder"),j=n.find("#new"+b+"_parent");n.find("#"+b+"-add-submit").prop("disabled",false);if("undefined"!=l.parsed.responses[0]&&(k=l.parsed.responses[0].supplemental.newcat_parent)){j.before(k);j.remove()}};g.find("#"+b+"checklist").wpList({alt:"",response:b+"-ajax-response",addBefore:catAddBefore,addAfter:i});g.find("#"+b+"-add-toggle").click(function(){a(this).parents("#"+b+"-adder").toggleClass("wp-hidden-children").siblings("#"+b+"-tabs").find('a[href="#'+b+'-all"]').click();a(this).parents("#"+b+"-adder").find("#new"+b).focus();return false});g.find("#"+b+"checklist li.popular-category :checkbox, #"+b+"checklist-pop :checkbox").live("click",function(){var j=a(this),l=j.is(":checked"),k=j.val();if(k&&j.parents("#taxonomy-"+b).length){j.parents("#taxonomy-"+b).find("#in-"+b+"-"+k+", #in-popular-"+b+"-"+k).prop("checked",l)}})})});